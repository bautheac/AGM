---
title: "Data availability"
format:
  html:
    page-layout: full
editor: visual
---

# 1913 - first 50 firms

```{r}
#| label: load
#| echo: false
#| message: false
library(magrittr)

here::here(
  "Dropbox/pro/Strathclyde/Fintech research assistant/AGM"
) %>% setwd()

col_types <- c(rep("c", 2L), "i", "?", "c", "?", rep("c", 5L), rep("l", 3L))
data <- readr::read_csv("data/availables.csv", col_types = col_types)
```

```{r}
#| label: tranform
#| echo: false
#| message: false
availables <- dplyr::filter(data, !is.na(event)) %>% 
  tidyr::pivot_longer(cols = c("traded", "price", "spread"), "field", "value") %>%
  dplyr::mutate(
    event = factor(event, levels = c("AU", "LD", "FC", "LC", "GM")),
    liability = factor(liability, levels = c("equity", "debt")),
    field = factor(field, levels = c("traded", "price", "spread"))
  ) %>%
  dplyr::arrange(year, event, liability, instrument, field)
```

```{r}
#| echo: false
#| message: false

availables <- dplyr::group_by(
  availables, company, year, event, liability, instrument, field
  ) %>%
  dplyr::summarise(one = any(value), .groups = "drop") %>%
  dplyr::filter(year == 1913) %>% 
  dplyr::ungroup() %>% 
  dplyr::group_by(year, event, liability, instrument, field) %>%
  dplyr::summarise(n = sum(one), .groups = "drop")

```

For the year 1913 and the first 50 firms with events in 1913, this table displays the number of firms showing at least one record for each instrument categories and fields.

E.g. Amongst the first 50 firms showing a closing year date for the 1913 year as well as a date for at least one event for that year including audit (AU), signing of the letter (LD), first day of closed books (FC), last day of closed books (LC) and general meeting (GM), 30 had common stock trading on their corresponding audit day, 15 showed data for price and 29 for spread.

```{r}
#| echo: false

availables <-tidyr::pivot_wider(availables, names_from = field, values_from = n)


kableExtra::kbl(availables, align = "l") %>% 
  kableExtra::kable_styling() %>% 
  kableExtra::scroll_box(width = "textwidth", height = "50vh")
```

For the year 1913 and the first 50 firms with events for that year, the following table displays the firms that show price data on each of their event days:

```{r}
#| echo: false

all <- dplyr::filter(data, liability == "equity", instrument == "common", is.na(type)) %>%
  dplyr::select(
    company, id, year, `year end date`, event, `event date`, `price`
    ) %>%  dplyr::group_by(company, id, year, `year end date`) %>%
  dplyr::summarise(all = all(price), .groups = "drop") %>% 
  dplyr::filter(all) %>% dplyr::select(-all)

kableExtra::kbl(all, align = "l") %>% kableExtra::kable_styling()
```

For the year 1913 and the first 50 firms with events for that year, the following table table displays the number of events for each firm along with the number of these that have price data:

```{r}
#| echo: false

counts <- dplyr::filter(
  data, liability == "equity", instrument == "common", is.na(type), 
  !is.na(`year end date`)
  ) %>%
  dplyr::select(
    company, id, year, `year end date`, event, `event date`, `price`
    ) %>% 
  dplyr::group_by(company, id, year, `year end date`) %>%
  dplyr::summarise(
    `number of events` = dplyr::n(),
    `number of events with price data` = sum(price), 
    .groups = "drop"
    ) %>% 
  dplyr::arrange(
    dplyr::desc(`number of events`), dplyr::desc(`number of events with price data`), 
    )

kableExtra::kbl(counts, align = "l") %>% 
  kableExtra::kable_styling() %>%
  kableExtra::scroll_box(width = "textwidth", height = "50vh")
```

## Limited availability
